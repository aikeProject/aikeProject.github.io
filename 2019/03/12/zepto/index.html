<!DOCTYPE HTML><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta http-equiv="Cache-Control" content="no-siteapp"><meta http-equiv="Cache-Control" content="no-transform"><meta name="renderer" content="webkit|ie-comp|ie-stand"><meta name="apple-mobile-web-app-capable" content="成雨的个人博客"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=no,email=no,adress=no"><meta name="browsermode" content="application"><meta name="screen-orientation" content="portrait"><link rel="dns-prefetch" href="http://blog.rensailong.top"><meta name="keywords" content="zepto,js"><meta name="description" content="zepto源码
zepto的基本骨架
123456789101112131415161718(function (global, factory) &#123;    // 区分当前引用环境  ..."><meta name="robots" content="all"><meta name="google" content="all"><meta name="googlebot" content="all"><meta name="verify" content="all"><title>zepto | 成雨的个人博客</title><link rel="alternate" href="/atom.xml" title="成雨的个人博客" type="application/atom+xml"><link rel="icon" href="/favicon-20190220051001892.ico"><link rel="stylesheet" href="/css/bootstrap.min.css?rev=0ee553ffb8c61021be4ac517c25c07b5"><link rel="stylesheet" href="/css/font-awesome.min.css?rev=afecc2c74d492b747ec32ef68e9d06ec"><link rel="stylesheet" href="/css/style.css?rev=20c56e3d4978a648b6298e44bd3ae711"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?ccd98c2d3b145ffad4c50be87f40400b";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><meta name="baidu-site-verification" content="Ic3zHIPe6C"><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script></head></html><!--[if lte IE 8]><style>
    html{ font-size: 1em }
</style><![endif]--><!--[if lte IE 9]><div style="ie">你使用的浏览器版本过低，为了你更好的阅读体验，请更新浏览器的版本或者使用其他现代浏览器，比如Chrome、Firefox、Safari等。</div><![endif]--><body><header class="main-header" style="background-image:url(/./img/my-banner.jpg)"><div class="main-header-box"><a class="header-avatar" href="/" title="成雨"><img src="/img/avatar.jpg" alt="logo头像" class="img-responsive center-block"></a><div class="branding"><h2>你若化成风，我便化成雨</h2></div></div></header><nav class="main-navigation"><div class="container"><div class="row"><div class="col-sm-12"><div class="navbar-header"><span class="nav-toggle-button collapsed pull-right" data-toggle="collapse" data-target="#main-menu" id="mnav"><span class="sr-only"></span><i class="fa fa-bars"></i></span> <a class="navbar-brand" href="http://blog.rensailong.top">成雨的个人博客</a></div><div class="collapse navbar-collapse" id="main-menu"><ul class="menu"><li role="presentation" class="text-center"><a href="/"><i class="fa"></i> 首页</a></li><li role="presentation" class="text-center"><a href="/categories/前端/"><i class="fa"></i> 前端</a></li><li role="presentation" class="text-center"><a href="/categories/后端/"><i class="fa"></i> 后端</a></li><li role="presentation" class="text-center"><a href="/categories/工具/"><i class="fa"></i> 工具</a></li><li role="presentation" class="text-center"><a href="/archives/"><i class="fa"></i> 时间轴</a></li></ul></div></div></div></div></nav><section class="content-wrap"><div class="container"><div class="row"><main class="col-md-8 main-content m-post"><p id="process"></p><article class="post"><div class="post-head"><h1 id="zepto">zepto</h1><div class="post-meta"><span class="categories-meta fa-wrap"><i class="fa fa-folder-open-o"></i> <a class="category-link" href="/categories/前端/">前端</a></span><span class="fa-wrap"><i class="fa fa-tags"></i> <span class="tags-meta"><a class="tag-link" href="/tags/js/">js</a> <a class="tag-link" href="/tags/zepto/">zepto</a></span></span><span class="fa-wrap"><i class="fa fa-clock-o"></i> <span class="date-meta">2019/03/12</span></span><span class="fa-wrap"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span></span></div></div><div class="post-body post-content"><h4 id="zepto源码"><a href="#zepto源码" class="headerlink" title="zepto源码"></a><code>zepto</code>源码</h4><ul><li><p><code>zepto</code>的基本骨架</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">global, factory</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 区分当前引用环境</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> define === <span class="string">'function'</span> &amp;&amp; define.amd)</span><br><span class="line">        define(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> factory(global)</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        factory(global);</span><br><span class="line">&#125;)(<span class="keyword">this</span>, <span class="function"><span class="keyword">function</span> (<span class="params">window</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// zepto核心代码写在这里面</span></span><br><span class="line">    <span class="keyword">var</span> zepto = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;)();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将zepto挂载到window上，即可以直接使用Zepto或$调用</span></span><br><span class="line">    <span class="built_in">window</span>.Zepto = Zepto;</span><br><span class="line">    <span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li><li><p>一些知识点</p></li><li>真伪数组转换<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 真数组转化为伪数组</span></span><br><span class="line"><span class="keyword">var</span> obj = &#123;&#125;;</span><br><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>];</span><br><span class="line">[].push.apply(obj,arr);</span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">var</span> arr = [];</span><br><span class="line"> <span class="keyword">var</span> obj = &#123;</span><br><span class="line">     <span class="number">0</span>:<span class="string">'邵蒙蒙'</span>,</span><br><span class="line">     <span class="number">1</span>:<span class="number">25</span>,</span><br><span class="line">     <span class="number">2</span>:<span class="string">'女'</span>,</span><br><span class="line">     length:<span class="number">3</span></span><br><span class="line"> &#125;;</span><br><span class="line"> [].push.apply(arr,obj);</span><br><span class="line"> <span class="built_in">console</span>.log(arr);</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 一般浏览器可以把系统自带的伪数组以及自定义的伪数组转化成真的数组,</span></span><br><span class="line"><span class="comment">// 但是在ie8及其以下版本,在ie8以及以下不能通过apply方法把对应的自定义的伪数组转化成对应的值,</span></span><br><span class="line"><span class="comment">// 所以我们可以先把伪数组转化成真的数组,然后通过apply方法来设置</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 采用slice方法将自定义的伪数组转换为真数组</span></span><br><span class="line">    <span class="keyword">var</span> obj = &#123;</span><br><span class="line">        <span class="number">0</span>:<span class="string">'邵蒙蒙'</span>,</span><br><span class="line">        <span class="number">1</span>:<span class="number">25</span>,</span><br><span class="line">        <span class="number">2</span>:<span class="string">'女'</span>,</span><br><span class="line">        length:<span class="number">3</span></span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">var</span> arr = [].slice.call(obj);</span><br><span class="line">    <span class="built_in">console</span>.log(arr);</span><br></pre></td></tr></table></figure></li></ul><ul><li>nodeType</li></ul><table><thead><tr><th>节点类型</th><th>描述</th><th>子节点</th></tr></thead><tbody><tr><td>Element</td><td>代表元素</td><td>Element, Text, Comment, ProcessingInstruction, CDATASection, EntityReference</td></tr><tr><td>Attr</td><td>代表属性</td><td>Text, EntityReference</td></tr><tr><td>Text</td><td>代表元素或属性中的文本内容。</td><td>None</td></tr><tr><td>CDATASection</td><td>代表文档中的 CDATA 部分（不会由解析器解析的文本）。</td><td>None</td></tr><tr><td>EntityReference</td><td>代表实体引用。</td><td>Element, ProcessingInstruction, Comment, Text, CDATASection, EntityReference</td></tr><tr><td>Entity</td><td>代表实体。</td><td>Element, ProcessingInstruction, Comment, Text, CDATASection, EntityReference</td></tr><tr><td>ProcessingInstruction</td><td>代表处理指令。</td><td>None</td></tr><tr><td>Comment</td><td>代表注释。</td><td>None</td></tr><tr><td>Document</td><td>代表整个文档（DOM 树的根节点）。</td><td>Element, ProcessingInstruction, Comment, DocumentType</td></tr><tr><td>DocumentFragment</td><td>代表轻量级的 Document 对象，能够容纳文档的某个部分</td><td>Element, ProcessingInstruction, Comment, Text, CDATASection, EntityReference</td></tr><tr><td>Notation</td><td>代表 DTD 中声明的符号。</td><td>None</td></tr></tbody></table><ul><li>‘readyState’ HTML DOM readyState 属性返回当前文档状态 <code>document.readyState</code> <a href="https://segmentfault.com/a/1190000005869515" target="_blank" rel="noopener">详见</a></li></ul><table><thead><tr><th>readyState</th><th>返回值</th></tr></thead><tbody><tr><td>uninitialized</td><td>还未开始载入</td></tr><tr><td>loading</td><td>载入中</td></tr><tr><td>interactive</td><td>已加载，文档与用户可以交互</td></tr><tr><td>complete</td><td>载入完成</td></tr></tbody></table><ul><li><p>关于页面加载的一些事件</p><ul><li><code>onload</code>事件，<code>window.onload</code>. 作用: onload事件的实际效果是当页面解析完DOM树，并且完成了所有图片、样式表、脚本等资源的加载后才被触发</li><li><code>DOMContentLoaded</code>, DOM内容加载完后就触发，无需等待其他资源的加载完成。</li><li><code>onreadystatechange</code> 低版本ie不支持<code>DOMContentLoaded</code>，可以用<code>onreadystatechange</code>代替</li><li><code>doScroll</code> 低于<code>ie8</code>,可以通过每隔一段时间执行一次document.documentElement.doScroll(“left”)来检测这一状态，因为这条代码在DOM加载完毕之前执行时会抛出错误(throw an error)</li></ul></li><li><p><code>setTimeout(fn, 0)</code>的应用 <a href="https://blog.csdn.net/jingtian678/article/details/79547596" target="_blank" rel="noopener">详见</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(fn, 0)的一大应用是，可以调整事件的发生顺序。比如，网页开发中，某个事件先发生在子元素，然后冒泡到父元素，即子元素的事件回调函数，会早于父元素的事件回调函数触发。如果，我们先让父元素的事件回调函数先发生，就要用到setTimeout(fn, 0);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">document.getElementById(&quot;haoroomsID&quot;).onclick = function A() &#123;</span><br><span class="line">  setTimeout(function B() &#123;</span><br><span class="line">	console.log(&quot;触发子元素事件&quot;)</span><br><span class="line">  &#125;, 0)</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">document.body.onclick = function C() &#123;</span><br><span class="line"> console.log(&quot;触发父元素事件&quot;)</span><br><span class="line">&#125;;</span><br><span class="line">点击haoroomsID会先触发父级元素事件，然后再触发子元素事件</span><br></pre></td></tr></table></figure></li></ul><ul><li><code>init</code>初始化函数入口<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// @author 成雨</span></span><br><span class="line"><span class="comment">// @date 2017/12/21</span></span><br><span class="line"><span class="comment">// @Description: zepto.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// zepto核心代码写在这里面</span></span><br><span class="line"><span class="keyword">var</span> Zepto = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $, zepto = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> emptyArray = [];</span><br><span class="line">    <span class="keyword">var</span> sconcat = emptyArray.concat,</span><br><span class="line">        filter = emptyArray.filter,</span><br><span class="line">        slice = emptyArray.slice;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 正则表达式</span></span><br><span class="line">    <span class="comment">// 类似于这样的'&lt;html&gt;', '&lt;html&gt;d&lt;/html&gt;'会被匹配，html片段</span></span><br><span class="line">    <span class="keyword">var</span> fragmentRE = <span class="regexp">/^\s*&lt;(\w+|!)[^&gt;]*&gt;/</span>,</span><br><span class="line">        <span class="comment">// '&lt;html&gt;&lt;/html&gt;' '&lt;html&gt;' '&lt;html/&gt;' 将会被匹配</span></span><br><span class="line">        singleTagRE = <span class="regexp">/^&lt;(\w+)\s*\/?&gt;(?:&lt;\/\1&gt;|)$/</span>,</span><br><span class="line">        <span class="comment">// 匹配这样的内容 '&lt;div id="dddd"/&gt; &lt;p /&gt;'</span></span><br><span class="line">        tagExpanderRE = <span class="regexp">/&lt;(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^&gt;]*)\/&gt;/ig</span>,</span><br><span class="line">        simpleSelectorRE = <span class="regexp">/^[\w-]*$/</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置属性</span></span><br><span class="line">    <span class="keyword">var</span> methodAttributes = [<span class="string">'val'</span>, <span class="string">'css'</span>, <span class="string">'html'</span>, <span class="string">'text'</span>, <span class="string">'data'</span>, <span class="string">'width'</span>, <span class="string">'height'</span>, <span class="string">'offset'</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> table = <span class="built_in">document</span>.createElement(<span class="string">'table'</span>),</span><br><span class="line">        tableRow = <span class="built_in">document</span>.createElement(<span class="string">'tr'</span>),</span><br><span class="line">        containers = &#123;</span><br><span class="line">            <span class="string">'tr'</span>: <span class="built_in">document</span>.createElement(<span class="string">'tbody'</span>),</span><br><span class="line">            <span class="string">'tbody'</span>: table,</span><br><span class="line">            <span class="string">'thead'</span>: table,</span><br><span class="line">            <span class="string">'tfoot'</span>: table,</span><br><span class="line">            <span class="string">'td'</span>: tableRow,</span><br><span class="line">            <span class="string">'th'</span>: tableRow,</span><br><span class="line">            <span class="string">'*'</span>: <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">    <span class="keyword">var</span> isArray = <span class="built_in">Array</span>.isArray ||</span><br><span class="line">        <span class="function"><span class="keyword">function</span> (<span class="params">object</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> object <span class="keyword">instanceof</span> <span class="built_in">Array</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> class2type = &#123;&#125;,</span><br><span class="line">        toString = class2type.toString;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> camelize, uniq;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//TODO 类型检测的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">type</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 第一次调用都会返回‘object’</span></span><br><span class="line">        <span class="keyword">return</span> obj == <span class="literal">null</span> ? <span class="built_in">String</span>(obj) :</span><br><span class="line">            class2type[toString.call(obj)] || <span class="string">"object"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//TODO isFunction 检测是否是函数</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">isFunction</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> type(value) == <span class="string">'function'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//TODO 判断是不是 'window'对象 window == window.window -&gt; true</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">isWindow</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obj != <span class="literal">null</span> &amp;&amp; obj == obj.window</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">isObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> type(obj) == <span class="string">"object"</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//TODO 纯对象</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">isPlainObject</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> isObject(obj) &amp;&amp; !isWindow(obj) &amp;&amp; <span class="built_in">Object</span>.getPrototypeOf(obj) == <span class="built_in">Object</span>.prototype</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 判断是不是伪数组</span></span><br><span class="line">    <span class="comment">// TODO likeArray 伪数组</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">likeArray</span>(<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> length = !!obj &amp;&amp; <span class="string">'length'</span> <span class="keyword">in</span> obj &amp;&amp; obj.length,</span><br><span class="line">            type = $.type(obj);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'function'</span> != type &amp;&amp; !isWindow(obj) &amp;&amp; (</span><br><span class="line">            <span class="string">'array'</span> == type || length === <span class="number">0</span> ||</span><br><span class="line">            (<span class="keyword">typeof</span> length == <span class="string">'number'</span> &amp;&amp; length &gt; <span class="number">0</span> &amp;&amp; (length - <span class="number">1</span>) <span class="keyword">in</span> obj)</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">compact</span>(<span class="params">array</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> filter.call(array, <span class="function"><span class="keyword">function</span> (<span class="params">item</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> item != <span class="literal">null</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将一组字符串变成“骆驼”命名法的新字符串，如果该字符已经是“骆驼”命名法，则不变化。</span></span><br><span class="line">    camelize = <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> str.replace(<span class="regexp">/-+(.)?/g</span>, <span class="function"><span class="keyword">function</span> (<span class="params">match, chr</span>) </span>&#123;</span><br><span class="line">            <span class="comment">// toUpperCase首字母大写</span></span><br><span class="line">            <span class="keyword">return</span> chr ? chr.toUpperCase() : <span class="string">''</span>;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将dom挂载到Z对象实例上</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Z</span>(<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> i, len = dom ? dom.length : <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len; i++) <span class="keyword">this</span>[i] = dom[i];</span><br><span class="line">        <span class="keyword">this</span>.length = len;</span><br><span class="line">        <span class="keyword">this</span>.selector = selector || <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 接受一个html字符串和一个可选的标签名</span></span><br><span class="line">    <span class="comment">// 从给定的html字符串生成DOM节点</span></span><br><span class="line">    <span class="comment">// 生成的DOM节点作为数组返回</span></span><br><span class="line">    <span class="comment">// html 标签字符串 name 标签名 properties 属性对象</span></span><br><span class="line">    zepto.fragment = <span class="function"><span class="keyword">function</span> (<span class="params">html, name, properties</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> dom, nodes, container;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 空标签将会被匹配</span></span><br><span class="line">        <span class="comment">// '&lt;div&gt;&lt;/div&gt;' '&lt;div&gt;' '&lt;div/&gt;' 将会被匹配 其中'RegExp.$1'的$1代表了'html'</span></span><br><span class="line">        <span class="keyword">if</span> (singleTagRE.test(html)) dom = $(<span class="built_in">document</span>.createElement(<span class="built_in">RegExp</span>.$<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果不符合上一个条件</span></span><br><span class="line">        <span class="keyword">if</span> (!dom) &#123;</span><br><span class="line">            <span class="comment">// '&lt;div id="dddd"/&gt; &lt;p /&gt;' 将转换为 '&lt;div id="dddd"&gt;&lt;/div&gt; &lt;p &gt;&lt;/p&gt;'</span></span><br><span class="line">            <span class="keyword">if</span> (html.replace) html = html.replace(tagExpanderRE, <span class="string">"&lt;$1&gt;&lt;/$2&gt;"</span>);</span><br><span class="line">            <span class="comment">// 获取到标签名 比如'&lt;div id="dddd"/&gt; &lt;p /&gt;' -&gt; name = div(RegExp.$1)</span></span><br><span class="line">            <span class="keyword">if</span> (name === <span class="literal">undefined</span>) name = fragmentRE.test(html) &amp;&amp; <span class="built_in">RegExp</span>.$<span class="number">1</span>;</span><br><span class="line">            <span class="comment">// 根据'containers'的内容来确定要用来包裹内容的元素</span></span><br><span class="line">            <span class="keyword">if</span> (!(name <span class="keyword">in</span> containers)) name = <span class="string">'*'</span>;</span><br><span class="line"></span><br><span class="line">            container = containers[name];</span><br><span class="line">            container.innerHTML = <span class="string">''</span> + html;</span><br><span class="line">            <span class="comment">// TODO slice.call 真伪数组转换</span></span><br><span class="line">            <span class="comment">// container.childNodes伪数组 这里是将伪数组转化真数组</span></span><br><span class="line">            dom = $.each(slice.call(container.childNodes), <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                container.removeChild(<span class="keyword">this</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// TODO $('&lt;div&gt;&lt;/div&gt;', &#123;height: '10px'&#125;) 如果是一个纯对象</span></span><br><span class="line">        <span class="comment">// 作用就是将其添加到创建好的dom里面</span></span><br><span class="line">        <span class="keyword">if</span> (isPlainObject(properties)) &#123;</span><br><span class="line">            <span class="comment">// zepto对象</span></span><br><span class="line">            nodes = $(dom);</span><br><span class="line">            $.each(properties, <span class="function"><span class="keyword">function</span> (<span class="params">key, value</span>) </span>&#123;</span><br><span class="line">                <span class="comment">// ['val', 'css', 'html', 'text', 'data', 'width', 'height', 'offset']</span></span><br><span class="line">                <span class="comment">// 如果是设置这些属性，调用定义在zepto的方法进行设置</span></span><br><span class="line">                <span class="keyword">if</span> (methodAttributes.indexOf(key) &gt; <span class="number">-1</span>) &#123;</span><br><span class="line">                    nodes[key](value);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// attr方法进行设置</span></span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    nodes.attr(key, value);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> dom;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 实例化Z构造函数</span></span><br><span class="line">    zepto.Z = <span class="function"><span class="keyword">function</span> (<span class="params">dom, selector</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Z(dom, selector);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//isZ 其中 instanceof 可检测对象是否在对象的上或者其原型上</span></span><br><span class="line">    zepto.isZ = <span class="function"><span class="keyword">function</span> (<span class="params">object</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> object <span class="keyword">instanceof</span> zepto.Z;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO 选择器方法</span></span><br><span class="line">    <span class="comment">// 作用：</span></span><br><span class="line">    <span class="comment">// '#id' -&gt; document.getElementById</span></span><br><span class="line">    <span class="comment">// '.class' -&gt; document.getElementsByClassName</span></span><br><span class="line">    <span class="comment">// 'div' -&gt; document.getElementsByTagName</span></span><br><span class="line">    <span class="comment">// '其他' -&gt; document.querySelectorAll</span></span><br><span class="line">    zepto.qsa = <span class="function"><span class="keyword">function</span> (<span class="params">element, selector</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> found,</span><br><span class="line">            maybeID = selector[<span class="number">0</span>] == <span class="string">'#'</span>,</span><br><span class="line">            maybeClass = !maybeID &amp;&amp; selector[<span class="number">0</span>] == <span class="string">'.'</span>,</span><br><span class="line">            nameOnly = maybeID || maybeClass ? selector.slice(<span class="number">1</span>) : selector,</span><br><span class="line">            isSimple = simpleSelectorRE.test(nameOnly);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (element.getElementById &amp;&amp; isSimple &amp;&amp; maybeID) &#123;</span><br><span class="line">            found = element.getElementById(nameOnly);</span><br><span class="line">            <span class="keyword">if</span> (found) &#123;</span><br><span class="line">                <span class="keyword">return</span> [found];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> [];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (element.nodeType !== <span class="number">1</span> &amp;&amp; element.nodeType !== <span class="number">9</span> &amp;&amp; element.nodeType !== <span class="number">11</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> [];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> slice.call(</span><br><span class="line">                    isSimple &amp;&amp; !maybeID &amp;&amp; element.getElementsByClassName ?</span><br><span class="line">                        maybeClass ? element.getElementsByClassName(nameOnly) : element.getElementsByTagName(selector)</span><br><span class="line">                        : element.querySelectorAll(selector)</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO 初始化函数 init</span></span><br><span class="line">    <span class="comment">// selector 传入的选择器</span></span><br><span class="line">    <span class="comment">// 'init'主要做的事情就是根据传入的'selector'类型，分别判断执行不同的任务</span></span><br><span class="line">    zepto.init = <span class="function"><span class="keyword">function</span> (<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> dom;</span><br><span class="line">        <span class="comment">// 如果未传入参数'selector'</span></span><br><span class="line">        <span class="comment">// 如果什么都没有给出，返回一个空的Zepto集合</span></span><br><span class="line">        <span class="comment">// zepto.Z()将创建一个空的对象集合</span></span><br><span class="line">        <span class="keyword">if</span> (!selector) <span class="keyword">return</span> zepto.Z();</span><br><span class="line">        <span class="comment">// 如果'selector'传入字符串</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> selector == <span class="string">'string'</span>) &#123;</span><br><span class="line">            <span class="comment">// 去除前后空格</span></span><br><span class="line">            selector = selector.trim();</span><br><span class="line">            <span class="comment">// 判断‘selector’是不是一个标签字符串</span></span><br><span class="line">            <span class="keyword">if</span> (selector[<span class="number">0</span>] == <span class="string">'&lt;'</span> &amp;&amp; fragmentRE.test(selector)) &#123;</span><br><span class="line">                dom = zepto.fragment(selector, <span class="built_in">RegExp</span>.$<span class="number">1</span>, context), selector = <span class="literal">null</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 如果有上下文，要在上下文里查找</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) <span class="keyword">return</span> $(context).find(selector);</span><br><span class="line">            <span class="comment">// TODO css选择器</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                dom = zepto.qsa(<span class="built_in">document</span>, selector)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果传入的是一个函数‘function’，该函数在dom加载完时调用,这个就是平时我们用的jquery的ready函数</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (isFunction(selector)) &#123;</span><br><span class="line">            <span class="keyword">return</span> $(<span class="built_in">document</span>).ready(selector);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 传入对象是不是zepto对象</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (zepto.isZ(selector)) &#123;</span><br><span class="line">            <span class="keyword">return</span> selector;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 传入数组</span></span><br><span class="line">            <span class="keyword">if</span> (isArray(selector)) dom = compact(selector);</span><br><span class="line">            <span class="comment">// 传入一个对象</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (isObject(selector)) &#123;</span><br><span class="line">                dom = [selector], selector = <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 传入html片段</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (fragmentRE.test(selector)) &#123;</span><br><span class="line">                dom = zepto.fragment(selector.trim(), <span class="built_in">RegExp</span>.$<span class="number">1</span>, context), selector = <span class="literal">null</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 是否传入上下文</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (context !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> $(context).find(selector)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 是一个选择器</span></span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                dom = zepto.qsa(<span class="built_in">document</span>, selector)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 最后将找到的dom转化为zepto对象</span></span><br><span class="line">        <span class="keyword">return</span> zepto.Z(dom, selector)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用`zepto.init`进行初始化</span></span><br><span class="line">    $ = <span class="function"><span class="keyword">function</span> (<span class="params">selector, context</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> zepto.init(selector, context)</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将一个对象复制到另一个目标对象上</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">extend</span>(<span class="params">target, source, deep</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (key <span class="keyword">in</span> source) &#123;</span><br><span class="line">            <span class="comment">// 深拷贝</span></span><br><span class="line">            <span class="keyword">if</span> (deep &amp;&amp; (isPlainObject(source[key])) || isArray(source[key])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (isPlainObject(source[key]) &amp;&amp; !isPlainObject(target[key])) &#123;</span><br><span class="line">                    target[key] = &#123;&#125;;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (isArray(source[key]) &amp;&amp; !isArray(target[key])) &#123;</span><br><span class="line">                    target[key] = [];</span><br><span class="line">                &#125;</span><br><span class="line">                extend(target[key], source[key], deep);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 浅拷贝</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (source[key] !== <span class="literal">undefined</span>) &#123;</span><br><span class="line">                target[key] = source[key];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 通过源对象扩展目标对象的属性，源对象属性将覆盖目标对象属性。</span></span><br><span class="line">    <span class="comment">// 默认情况下为，复制为浅拷贝（浅复制）。如果第一个参数为true表示深度拷贝（深度复制）。</span></span><br><span class="line">    $.extend = <span class="function"><span class="keyword">function</span> (<span class="params">target</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> deep, args = slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> target == <span class="string">'boolean'</span>) &#123;</span><br><span class="line">            deep = target;</span><br><span class="line">            target = args.shift();</span><br><span class="line">        &#125;</span><br><span class="line">        args.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">org</span>) </span>&#123;</span><br><span class="line">            extend(target, org, deep)</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> target;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 工具方法</span></span><br><span class="line">    <span class="comment">// TODO 类型检测</span></span><br><span class="line">    $.type = type;</span><br><span class="line">    $.isFunction = isFunction;</span><br><span class="line">    $.isWindow = isWindow;</span><br><span class="line">    $.isArray = isArray;</span><br><span class="line">    $.isPlainObject = isPlainObject;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果该值为有限数值或一个字符串表示的数字，则返回ture。</span></span><br><span class="line">    $.isNumeric = <span class="function"><span class="keyword">function</span> (<span class="params">val</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> num = <span class="built_in">Number</span>(val), type = <span class="keyword">typeof</span> val;</span><br><span class="line">        <span class="keyword">return</span> val != <span class="literal">null</span> &amp;&amp; type != <span class="string">'boolean'</span> &amp;&amp;</span><br><span class="line">            (type != <span class="string">'string'</span> || val.length) &amp;&amp;</span><br><span class="line">            !<span class="built_in">isNaN</span>(num) &amp;&amp; <span class="built_in">isFinite</span>(num) || <span class="literal">false</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// $.inArray(element, array, [fromIndex])   ⇒ number</span></span><br><span class="line">    <span class="comment">// 返回数组中指定元素的索引值（注：以0为基数），如果没有找到该元素则返回-1。</span></span><br><span class="line">    $.inArray = <span class="function"><span class="keyword">function</span> (<span class="params">elem, array, i</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> emptyArray.indexOf.call(array, elem, i);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 驼峰 命名转化</span></span><br><span class="line">    $.camelCase = camelize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO 遍历 each</span></span><br><span class="line">    $.each = <span class="function"><span class="keyword">function</span> (<span class="params">elements, callback</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> i, key;</span><br><span class="line">        <span class="keyword">if</span> (likeArray(elements)) &#123;</span><br><span class="line">            <span class="comment">// 用数组的循环方法</span></span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; elements.length; i++)</span><br><span class="line">                <span class="keyword">if</span> (callback.call(elements[i], i, elements[i]) === <span class="literal">false</span>) <span class="keyword">return</span> elements</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 用对象的循环方法</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (key <span class="keyword">in</span> elements)</span><br><span class="line">                <span class="keyword">if</span> (callback.call(elements[key], key, elements[key]) === <span class="literal">false</span>) <span class="keyword">return</span> elements</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> elements;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// $.grep(items, function(item)&#123; ... &#125;)   ⇒ array</span></span><br><span class="line">    <span class="comment">// 获取一个新数组，新数组只包含回调函数中返回 ture 的数组项。</span></span><br><span class="line">    <span class="comment">// 同 filter()方法</span></span><br><span class="line">    $.grep = <span class="function"><span class="keyword">function</span> (<span class="params">element, callback</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> filter.call(element, callback);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Populate the class2type map</span></span><br><span class="line">    <span class="comment">// 第一次调用 ‘$.each’ 给 'class2type' 赋值, 类型检测的运用</span></span><br><span class="line">    $.each(<span class="string">"Boolean Number String Function Array Date RegExp Object Error"</span>.split(<span class="string">" "</span>), <span class="function"><span class="keyword">function</span> (<span class="params">i, name</span>) </span>&#123;</span><br><span class="line">        class2type[<span class="string">"[object "</span> + name + <span class="string">"]"</span>] = name.toLowerCase();</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// TODO s.fn 定义所有可用方法</span></span><br><span class="line">    <span class="comment">// Zepto.fn是一个对象，它拥有Zepto对象上所有可用的方法，如 addClass()， attr()，和其它方法。在这个对象添加一个方法，所有的Zepto对象上都能用到该方法。</span></span><br><span class="line">    $.fn = &#123;</span><br><span class="line">        <span class="comment">// 将其指向 zepto.Z 这个函数</span></span><br><span class="line">        <span class="keyword">constructor</span>: zepto.Z,</span><br><span class="line">        length: 0,</span><br><span class="line"></span><br><span class="line">        // dom加载完毕的检测函数</span><br><span class="line">        // 详见 https://segmentfault.com/a/1190000005869515</span><br><span class="line">        // TODO ready</span><br><span class="line">        ready: function (callback) &#123;</span><br><span class="line">            <span class="comment">// 详见README readyState 的几个状态</span></span><br><span class="line">            <span class="comment">// document.documentElement.doScroll 这句话作用是非ie，也就是这里ie不支持</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">document</span>.readyState === <span class="string">'complete'</span></span><br><span class="line">                || (<span class="built_in">document</span>.readyState === <span class="string">'loading'</span> &amp;&amp; !<span class="built_in">document</span>.documentElement.doScroll)) &#123;</span><br><span class="line">                <span class="comment">// setTimeout(fn, 0)的应用 详见 https://blog.csdn.net/jingtian678/article/details/79547596</span></span><br><span class="line">                setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    callback($);</span><br><span class="line">                &#125;, <span class="number">0</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">var</span> handler = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                    <span class="built_in">document</span>.removeEventListener(<span class="string">'DOMContentLoaded'</span>, handler, <span class="literal">false</span>);</span><br><span class="line">                    <span class="built_in">window</span>.removeEventListener(<span class="string">'load'</span>, handler, <span class="literal">false</span>);</span><br><span class="line">                    callback($);</span><br><span class="line">                &#125;;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">document</span>.addEventListener(<span class="string">'DOMContentLoaded'</span>, handler, <span class="literal">false</span>);</span><br><span class="line">                <span class="built_in">window</span>.addEventListener(<span class="string">'load'</span>, handler, <span class="literal">false</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里就是将‘$.fn’ 添加到 ‘zepto.Z’的原型上 和 ‘Z’的原型上</span></span><br><span class="line">    zepto.Z.prototype = Z.prototype = $.fn;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> $;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将zepto挂载到window上，即可以直接使用Zepto或$调用</span></span><br><span class="line"><span class="built_in">window</span>.Zepto = Zepto;</span><br><span class="line"><span class="built_in">window</span>.$ === <span class="literal">undefined</span> &amp;&amp; (<span class="built_in">window</span>.$ = Zepto);</span><br></pre></td></tr></table></figure></li></ul></div><div class="post-footer"><div>转载声明：商业转载请联系作者获得授权,非商业转载请注明出处 © <a href="//github.com/aikeProject" target="_blank">Snippet</a></div><div></div></div></article><div class="article-nav prev-next-wrap clearfix"><a href="/2019/03/07/Selenium/" class="next-post btn btn-default" title="Selenium"><span class="hidden-lg">下一篇</span> <span class="hidden-xs">Selenium</span><i class="fa fa-angle-right fa-fw"></i></a></div><div id="comments"><div id="vcomments" class="valine"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="/assets/valine.min.js"></script><script>new Valine({av:AV,el:"#vcomments",appId:"4fxhv6ljJpn9Ri1OJgXCMQCH-gzGzoHsz",appKey:"ef2FdLkY74Ypgpu6k9FDcGep",placeholder:"畅所欲言",notify:!1,verify:!1,avatar:"mm",meta:"nick,mail".split(","),pageSize:"10",path:window.location.pathname,lang:"zh-CN".toLowerCase()})</script></div></main><aside id="article-toc" role="navigation" class="col-md-4"><div class="widget"><h3 class="title">文章目录</h3><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#zepto源码"><span class="toc-text">zepto源码</span></a></li></ol></div></aside></div></div></section><footer class="main-footer"><div class="container"><div class="row"></div></div></footer><a id="back-to-top" class="icon-btn hide"><i class="fa fa-chevron-up"></i></a><div class="copyright"><div class="container"><div class="row"><div class="col-sm-12"><div class="busuanzi">访问量:<strong id="busuanzi_value_site_pv"><i class="fa fa-spinner fa-spin"></i></strong> &nbsp; | &nbsp; 访客数:<strong id="busuanzi_value_site_uv"><i class="fa fa-spinner fa-spin"></i></strong></div></div><div class="col-sm-12"><span>Copyright &copy; 2017</span> | <span>Powered by <a href="//hexo.io" class="copyright-links" target="_blank" rel="nofollow">Hexo</a></span> | <span>Theme by <a href="//github.com/shenliyang/hexo-theme-snippet.git" class="copyright-links" target="_blank" rel="nofollow">Snippet</a></span></div></div></div></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/app.js?rev=586c04b4e85931a49156b4ee90d1d3b6"></script></body>